# TCG Engine - Action Plan

## 1. ドキュメントの目的と運用ルール

このドキュメントは、本TCGエンジンを「ヴァイスシュヴァルツの対戦シミュレーションが可能なゲーム」として完成させるための開発ロードマップです。

### 運用ルール
- **担当の明確化**: タスクに着手する際は、担当者欄に自分の名前を記載してください。
- **ステータスの更新**: タスクの進捗に応じて、ステータスを `未着手` -> `進行中` -> `完了` に更新してください。
- **タスクの追加**: 新しいタスクは、関連するマイルストーンの下に追加してください。大きなタスクは、関係者と合意の上で追加します。
- **完了の定義**: 「完了」とは、実装が完了し、関連するテストが成功した状態を指します。
- **タスクの分割と確認**: 予期せぬ中断リスクを考慮し、タスクは可能な限り短く区切って実装してください。一つの区切りがついたら、コンパイルや簡単な動作確認を行い、問題がなければ進捗を更新（またはコミット）することを推奨します。

---

## 2. 長期マイルストーン

ゴールに向けた高レベルな開発フェーズです。

| マイルストーン | 内容 | ステータス |
| :--- | :--- | :--- |
| **M1: コアロジックの実装完了** | ゲームのセットアップからターン進行、フェーズ遷移、基本的なルール処理まで、バックエンドのロジックを完成させる。 | `完了` |
| **M1.5: アーキテクチャのリファクタリング** | GameCoreとゲーム固有実装の分離を徹底し、設計をクリーンに保つための改善作業。 | `進行中` |
| **M2: UIとゲームロジックの接続** | Unity上でゲームの状態（手札、場、リソース等）が可視化され、更新が反映されるようにする。 | `未着手` |
| **M3: プレイヤー入力の実装** | UIやコンソールを通じて、プレイヤーがゲーム内のアクションを対話形式で行えるようにする。 | `進行中` |
| **M4: カード能力の拡充と自動化** | `AbilityFactory` を拡張し、多様なカード能力をデータ定義から自動生成・実行できるようにする。 | `未着手` |
| **M5: 対戦とテスト** | 2人対戦が可能になり、主要なカードの相互作用が正しく機能することを確認する。バグ修正とパフォーマンス改善を中心に行う。 | `未着手` |

---

## 3. 直近の詳細タスク

### M1: コアロジックの実装
*Note: 基本的なルールは実装完了。残るはカウンターステップの完全実装。*

| タスク ID | タスク内容 | 担当者 | ステータス |
| :--- | :--- | :--- | :--- |
| **T-01** | **ゲーム初期化処理 (`WeissGame.SetupGame`)** | Gemini | `完了` |
| **T-02** | **カードデータベースの構築** | Gemini | `完了` |
| **T-03** | **基本フェーズ遷移の実装** | Gemini | `完了` |
| **T-04** | **メインフェイズのアクションループ (`MainPhase.cs`)** | Gemini | `完了` |
| **T-04.5**| **コアロジックの安定化** | Gemini | `完了` |
| **T-05** | **アタックフェイズの基本処理 (`AttackPhase.cs`)** | Gemini | `完了` |
| **T-05.1** | **カウンターステップの実装**: 非ターンプレイヤーが助太刀カードを使用できるロジックを実装する。 | Gemini | `進行中` |
| **T-05.2** | **アンコールステップの実装** | Gemini | `完了` |

### M1.5: アーキテクチャのリファクタリング

| タスク ID | タスク内容 | 担当者 | ステータス |
| :--- | :--- | :--- | :--- |
| **T-R1** | **ゾーン関連インターフェースの移行**: `IDeckZone`, `IHandZone`など、`GameCore`に誤って配置されているゲーム固有のインターフェースを、`WeissSchwarz`配下に移動する。 | Gemini | `進行中` |

### M3: プレイヤー入力の実装
`ConsolePlayerController`を対話形式にするためのタスク。ゲームの進行順に沿って実装を進める。

**M3 - フェーズ1: ゲームセットアップと基本操作**
| タスク ID | タスク内容 | 担当者 | ステータス |
| :--- | :--- | :--- | :--- |
| **T-M3.1** | **マリガン選択**: ゲーム開始時に、手札からマリガンするカードを対話形式で選択できるようにする。 | Gemini | `完了` |
| **T-M3.2** | **レベルアップカード選択**: レベルアップ時、クロック置場の7枚のカードからレベル置場に送る1枚を対話形式で選択できるようにする。 | Gemini | `完了` |
| **T-M3.3** | **クロックフェイズ選択**: クロックフェイズで、手札からクロック置場に置くカードを任意で選択できるようにする。 | Gemini | `完了` |
| **T-M3.4** | **メインフェイズ行動選択**: メインフェイズで「カードプレイ」「能力起動」「フェイズ終了」を対話形式で選択できるようにする。 | Gemini | `完了` |
| **T-M3.5** | **手札からのカード選択**: カードをプレイする際、手札のリストから対話形式でカードを選択できるようにする。 | Gemini | `完了` |

**M3 - フェーズ2: アタックフェイズと関連処理**
| タスク ID | タスク内容 | 担当者 | ステータス |
| :--- | :--- | :--- | :--- |
| **T-M3.6** | **クライマックスカード選択**: クライマックスフェイズに、プレイするクライマックスカードを選択できるようにする。 | Gemini | `完了` |
| **T-M3.7** | **アタッカー選択**: アタックフェイズに、攻撃するキャラを対話形式で選択できるようにする。 | Gemini | `完了` |
| **T-M3.8** | **アタック種類選択**: フロントアタックかサイドアタックかを対話形式で選択できるようにする。 | Gemini | `完了` |
| **T-M3.9** | **アタック終了確認**: 各アタックの後、アタックフェイズを続けるか終了するかを選択できるようにする。 | Gemini | `完了` |
| **T-M3.10**| **カウンターカード選択**: カウンターステップで、使用する助太刀カードを選択できるようにする。 | Gemini | `完了` |
| **T-M3.11**| **アンコール選択**: アンコールステップで、アンコール（標準/特殊）を行うか否かを選択できるようにする。 | Gemini | `完了` |

**M3 - フェーズ3: カード能力の効果解決**
| タスク ID | タスク内容 | 担当者 | ステータス |
| :--- | :--- | :--- | :--- |
| **T-M3.12**| **起動能力の選択**: メインフェイズで、複数の起動能力がある場合にどれを使用するか選択できるようにする。 | Gemini | `完了` |
| **T-M3.13**| **任意効果の使用確認**: 「～してもよい」と書かれた自動能力（アタック時、登場時など全般）が発動した際に、使用するかどうかを「Y/N」で確認する仕組みを実装する。 | Gemini | `完了` |
| **T-M3.14**| **同時発動した自動能力の解決順選択**: 複数の自動能力が同時に発動した場合、プレイヤーが解決する順番を選択できるようにする。 | | `未着手` |
| **T-M3.15**| **控え室からのカード選択**: カード効果で控え室からカードを回収する際、対象を選択できるようにする。 | Gemini | `完了` |
| **T-M3.16**| **汎用的な対象選択**: カード効果による対象選択（例：「相手のキャラを1枚選ぶ」）や、公開されたカードからの選択など、汎用的な選択処理を実装する。 | Gemini | `完了` |

### M4: カード能力の拡充と自動化
| タスク ID | タスク内容 | 担当者 | ステータス |
| :--- | :--- | :--- | :--- |
| **T-M4.1** | **アンコールコストの汎用化**: アビリティテキストからコスト（例: `[(1)]`）を解析し、処理するロジックを実装する。 | | `未着手` |
| **T-M4.2** | **アンコールコスト支払い時のプレイヤー選択**: 手札のカードをコストにする際、どのカードを支払うかプレイヤーが選択できるようにする。 | | `未着手` |

### M2: UIとゲームロジックの接続
| タスク ID | タスク内容 | 担当者 | ステータス |
| :--- | :--- | :--- | :--- |
| **T-M2.1** | **`CardUI.cs` の作成**: 単一カードの表示を管理するスクリプトを作成する。 | Gemini | `未着手` |
| **T-M2.2** | **`HandZoneUI.cs` の作成**: 手札ゾーンの表示を管理するスクリプトを作成する。 | | `未着手` |
| **T-M2.3** | **`StageZoneUI.cs` の作成**: 舞台ゾーンの表示を管理するスクリプトを作成する。 | | `未着手` |
| **T-M2.4** | **`GameView.cs` の作成**: ゲームイベントに応じて各UIの更新を指示する管理スクリプトを作成する。 | | `未着手` |