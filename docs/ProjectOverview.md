# TCG Engine Project Overview

## 1. プロジェクト概要

このUnityプロジェクトは、様々なトレーディングカードゲーム（TCG）を実装するための、拡張可能で再利用性の高いTCGエンジンです。

中心的な `GameCore` ライブラリが汎用的なTCGの仕組みを提供し、それを拡張する形で `WeissSchwarz` のような特定のゲームルールが実装されています。将来的には `TCGPokemon` など、他のゲームへの展開も視野に入れた設計となっています。

## 2. 設計構造

本プロジェクトは、大きく分けて「汎用的なコアエンジン」と「ゲーム個別の実装」の2層構造で設計されています。

### 2.1. コアエンジン (`Assets/Scripts/GameCore`)

TCGの基本的な概念を抽象化した、ゲームに依存しないコンポーネント群です。

#### 主要コンポーネント

*   **ゲームフロー管理 (`GameBase`, `GameState`)**
    *   `GameBase`: ゲームの開始、ターン進行、フェーズ管理といった大まかな流れを定義する抽象クラス。
    *   `GameState`: 現在のプレイヤー、フェーズ、ゲーム全体の状態を保持します。全てのゲームロジックはこの`GameState`オブジェクトを介して状態を参照・更新します。

*   **イベント駆動アーキテクチャ (`EventBus`, `GameEvent`)**
    *   「カードがプレイされた」「フェーズが開始した」といったゲーム内の出来事を `GameEvent` として表現します。
    *   `EventBus` がこれらのイベントの発行と購読を管理します。これにより、各コンポーネントは他のコンポーネントを直接知ることなく、イベントを通じて連携できます（疎結合）。

*   **カードと能力 (`Card`, `AbilityBase`, `IEffect`)**
    *   `Card`: 全てのカードの基底クラス。物理的な状態（タップされているか、どのゾーンにあるか等）を管理します。
    *   `AbilityBase`: カードが持つ能力の基底クラス。「コスト」「トリガー条件」「効果」から構成されます。
    *   `IEffect`: 能力が解決されたときに実行される実際の効果（カードを引く、ダメージを与える等）を定義するインターフェース。

*   **ゾーン管理 (`IZone`, `ZoneBase`)**
    *   `IZone`: カードが存在する場所（ゾーン）を抽象化する最も基本的なインターフェースです。
    *   `ZoneBase`: 全てのゾーン実装の土台となる、カードリストの管理などの基本機能を提供します。
    *   これらは`GameCore`に属する最も基本的な概念です。`IDeckZone`や`IStageZone`のような、より具体的なゾーンの役割（役割）を定義するインターフェースは、各ゲーム固有の実装（例：`WeissSchwarz`）側に配置され、関心の分離が徹底されています。

### 2.2. ゲーム個別実装 (`Assets/Scripts/WeissSchwarz`)

`GameCore` を利用して、特定のTCG（この場合はヴァイスシュヴァルツ）のルールを実装します。

#### データ駆動型の能力設計

このプロジェクトの最大の特徴は、カード能力をC#コードで直接記述するのではなく、**データとして定義**している点です。

1.  **能力定義 (`AbilityDefinition`)**
    *   能力の種類（自動、起動、常時）、発動条件、コスト、効果などをプロパティとして持つクラスです。
    *   これにより、「【自】このカードが手札から舞台に置かれた時、あなたは自分の山札を上から1枚見て、山札の上か下に置く。」といった能力を、以下のようなデータ構造で表現できます。
        ```csharp
        new AbilityDefinition {
            Type = AbilityType.Auto,
            Condition = new ConditionDefinition { Event = "OnPlay" },
            Effects = new List<EffectDefinition> {
                new EffectDefinition { Kind = EffectKind.LookTopAndPlace, Count = 1 }
            }
        }
        ```

2.  **能力生成 (`AbilityFactory`)**
    *   `AbilityDefinition` オブジェクトを読み込み、それに対応する `AbilityBase` のインスタンス（コストや効果の具体的なロジックを持つオブジェクト）を動的に生成します。

この設計により、プログラマーでないゲームデザイナーでも、定義ファイルを編集するだけで新しいカードや能力を簡単に追加・修正することが可能になります。

#### 主要コンポーネント

*   `WeissGame`: `GameBase` を継承した、ヴァイスシュヴァルツのゲーム進行を管理するクラス。
*   `WeissRuleEngine`: ヴァイスシュヴァルツ固有のルール判定（例: レベルアップ、色発生）を担当します。
*   `WeissCard`: `Card` を継承し、ヴァイスシュヴァルツのカードが持つ固有のデータ（パワー、ソウル、特徴など）を管理します。
*   `Definitions` フォルダ: `AbilityDefinition`, `CostDefinition`, `EffectDefinition` など、データ駆動設計の根幹をなす定義クラスが格納されています。

## 3. フォルダ構造の概要

*   `Assets/Scripts/GameCore`: ゲームに依存しない共通ライブラリ。
*   `Assets/Scripts/TCGPokemon`: ポケモンカードゲーム用の実装（開発中）。
*   `Assets/Scripts/WeissSchwarz`: ヴァイスシュヴァルツ用の実装。
    *   `Core`: ゲーム進行やカード定義など、中核となるクラス群。
    *   `Abilities`: 能力の定義や生成に関するクラス群。
    *   `Zones`: ヴァイスシュヴァルツ固有のゾーン（クロック、レベル置場など）の実装。
*   `ProjectSettings`: Unityエディタの各種設定。
*   `Packages`: プロジェクトが依存するUnityパッケージのリスト。
