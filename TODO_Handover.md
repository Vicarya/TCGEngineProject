# TCG Engine - TODO引き継ぎドキュメント

## 概要

このドキュメントは、TCG Engineプロジェクトの現状と、今後の開発で実装が必要なタスク（TODO）をまとめたものです。

## 現状のアーキテクチャ

- **`GameCore`**: カード、ゾーン、プレイヤー、フェーズなど、TCGの汎用的な要素を定義するコアライブラリ。
- **`WeissSchwarz`**: `GameCore`を継承し、ヴァイスシュヴァルツ固有のカード、ゾーン、ルール、フェーズを実装。
- **ゲームフロー**: `WeissGame` -> `WeissRuleEngine` -> `WeissPhaseFactory` -> 各フェーズクラス (`StandPhase`, `AttackPhase`など) の順でゲームが進行します。
- **ルール処理**: ダメージ計算やレベルアップなどの主要なルールは `WeissRuleEngine` に集約されています。
- **プレイヤー入力**: `IPlayerController` インターフェースを介してプレイヤーの選択（カードをプレイするなど）を処理する設計です。

## 今後の開発タスク (TODOリスト)

### 1. ゲームの基本設定 (`WeissGame.cs`)

- [ ] **ゲーム初期化処理の実装**: `SetupGame` メソッド内に、以下の処理を実装する。
    - プレイヤーインスタンスの作成と登録。
    - 各プレイヤーのゾーン（Deck, Hand, Stageなど）の初期化。
    - デッキデータの読み込みとシャッフル。
    - 初期手札5枚のドロー処理。
    - 初期手札の引き直し（マリガン）処理。

### 2. プレイヤーの意思決定 (`IPlayerController` とその実装)

- [ ] **`IPlayerController` の実装**: プレイヤーの入力を受け付ける具体的なクラスを作成する（例：コンソール入力、UI入力、AIなど）。
- [ ] **各フェーズでの選択処理の実装**:
    - `ClockPhase`: 手札からクロックに置くカードを選択する。
    - `ClimaxPhase`: 手札からプレイするクライマックスカードを選択する。
    - `AttackPhase`:
        - アタックを行うか、フェイズを終了するか選択する。
        - 攻撃するキャラを選択する。
        - フロントアタックかサイドアタックかを選択する。
    - `EndPhase`: 手札が上限を超えている場合に捨てるカードを選択する。
    - `WeissRuleEngine`: レベルアップ時にレベル置場に置くカードを選択する。

### 3. ゲームルールの詳細実装

- [ ] **メインフェイズ (`MainPhase.cs`)**:
    - プレイヤーがアクション（キャラのプレイ、イベントの使用など）を繰り返し行えるアクションループを実装する。
- [ ] **アタックフェイズ (`AttackPhase.cs`)**:
    - **ダイレクトアタック**: アタッカーのソウルを+1する処理を実装する。
    - **ダメージステップ**: アタッカーのソウル値に基づいたダメージ計算と、`RuleEngine.ApplyDamage`の呼び出しを実装する。
    - **バトルステップ**: アタッカーと防御キャラのパワーを比較し、パワーが低い方をリバース状態にする処理を実装する。
    - **カウンターステップ**: 防御側プレイヤーにカウンターカードの使用機会を与える処理を実装する。
    - **アンコールステップ**: リバースしたキャラのアンコール処理を行う `EncorePhase` を作成し、`AttackPhase` の最後から遷移させる。
    - **ルール制約**: 「先攻プレイヤーの第1ターンは1回しかアタックできない」というルールを実装する。

### 4. カード能力と効果 (`AbilityFactory.cs`, `ConcentrateEffect.cs`)

- [ ] **効果（Effect）の実装**: `ConcentrateEffect` などの具体的なカード効果のロジックを実装する。
- [ ] **能力（Ability）の拡充**: `AbilityFactory` で、様々な種類のコスト、効果、トリガー条件を解決できるように拡張する。

### 5. リファクタリングと改善

- [ ] **`StageSlot.cs` の改善**: 現在 `WeissZone` を継承しているが、カードを1枚しか持たないため、よりシンプルなクラスへのリファクタリングを検討する。
- [ ] **`WaitingRoomZone.Clear()` の修正**: 現在はカードリストを空にするだけだが、リフレッシュ処理などでカードを別のゾーンに移動させるロジックに変更する。

---
このドキュメントを元に、各タスクをIssueとして管理し、開発を進めていくことを推奨します。